name: Trigger Render deploy

on:
  push:
    branches:
      - main
    # If you only want to trigger when the app folder changes, keep the paths filter.
    # Remove the `paths` section if you want every push to main to trigger a Render deploy.
    paths:
      - 'inspection-client-app/**'

jobs:
  trigger-render:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      # Optional: run tests or a local build check before triggering Render
      # - name: Run tests / optional local build
      #   run: |
      #     cd inspection-client-app
      #     npm ci
      #     npm test
      #   env:
      #     CI: true

      - name: Trigger deploy on Render
        env:
          RENDER_API_KEY: ${{ secrets.RENDER_API_KEY }}
          RENDER_SERVICE_ID: ${{ secrets.RENDER_SERVICE_ID }}
          GITHUB_SHA: ${{ github.sha }}
        run: |
          echo "Triggering Render deploy for service ${RENDER_SERVICE_ID} (commit ${GITHUB_SHA})"
          curl -s -X POST "https://api.render.com/v1/services/${RENDER_SERVICE_ID}/deploys" \
            -H "Authorization: Bearer ${RENDER_API_KEY}" \
            -H "Accept: application/json" \
            -H "Content-Type: application/json" \
            -d "{\"branch\":\"main\",\"commit\":\"${GITHUB_SHA}\",\"clearCache\":false}" \
            | jq .
